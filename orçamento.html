<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Orçamento Personalizada</title>
  
  <!-- SCRIPT DO EMAILJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <!-- FONTES DO GOOGLE -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ==================================
       ESTILOS PERSONALIZADOS DO SEU PROJETO
       ================================== */
    body {
      background: #dddddd; /* Fundo cinza do seu site */
      font-family: "Poppins", sans-serif;
      font-weight: 400;
      color: #666666;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    h1, h2, h3 {
      color: #152034;
      font-weight: 700;
    }

    /* Container Principal da Calculadora */
    .calculator-container {
      max-width: 600px;
      width: 100%;
      background: #ffffff;
      padding: 40px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    /* Card da Calculadora */
    .card {
      background-color: #ffffff;
      padding: 0;
      color: #152034;
      display: flex;
      flex-direction: column;
      text-align: center;
    }

    .card header {
      margin-bottom: 25px;
    }
    
    .card header h1 {
      font-size: 32px; /* Aumentado para mais destaque */
      margin-bottom: 10px;
      color: #152034;
    }

    /* Barra de Progresso */
    .progress {
      height: 6px;
      background-color: #e5e7eb;
      border-radius: 3px;
      overflow: hidden;
      margin-top: 15px;
    }

    .progress-bar {
      height: 100%;
      background-color: #f2ce00; /* Amarelo como cor de progresso */
      transition: width 0.4s ease-in-out;
      width: 0%;
    }
    
    #chatbot h2 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 25px;
    }

    /* Formulário Inicial (Estilo .contact-form) */
    .initial-form input {
      width: 100%;
      margin-bottom: 15px;
      color: #152034;
      background: transparent;
      border-radius: 0;
      border: none;
      border-bottom: 2px solid rgba(21, 32, 52, 0.3);
      height: 45px;
      padding: 8px 0;
      font-family: "Poppins", sans-serif;
      font-size: 16px;
      transition: all 0.3s;
    }
    .initial-form input:focus {
      outline: none;
      border-bottom-color: #152034;
    }
    .initial-form input::placeholder {
      color: #152034;
      opacity: 0.7;
    }

    /* Botões de Opção e Ação (Estilo .btn) */
    .options, .cta {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .initial-form button, .options button, .cta button, .cta a {
      display: block;
      width: 100%;
      padding: 15px 30px;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #152034;
      background: #f2ce00;
      border: 2px solid #f2ce00;
      border-radius: 0;
      transition: 0.3s;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
    }

    .initial-form button:hover, .options button:hover, .cta button:hover, .cta a:hover {
      color: #f2ce00;
      background: #152034;
      border-color: #152034;
    }

    /* Botão secundário (Refazer) */
    .cta button.btn-secondary {
        background: transparent;
        color: #152034;
        border: 2px solid #152034;
    }
    .cta button.btn-secondary:hover {
        background: #152034;
        color: #ffffff;
    }


    /* Seção de Resultados */
    .results h2 {
      margin-bottom: 10px;
      font-size: 22px;
    }

    .results .estimate-value {
      font-size: 42px;
      font-weight: 800;
      color: #152034;
      margin: 10px 0;
    }

    .results .monthly-fee {
      font-size: 16px;
      font-weight: 500;
      color: #666666;
    }

    .results .summary-title {
      margin-top: 30px;
      margin-bottom: 15px;
      font-weight: 700;
      font-size: 18px;
      color: #152034;
    }

    .results ul {
      list-style: none;
      padding: 0;
      text-align: left;
      margin-bottom: 30px;
      border-top: 1px solid #e5e7eb;
    }

    .results ul li {
      display: flex;
      justify-content: space-between;
      padding: 12px 5px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 15px;
    }

    .results ul li span:first-child {
      color: #666666;
    }
    
    .results ul li span:last-child {
      font-weight: 600;
      color: #152034;
    }

    /* Feedback de E-mail */
    #email-feedback {
      margin-top: 20px;
      font-size: 14px;
      font-weight: 500;
      color: #0d5a22; /* Verde para sucesso */
      height: 20px; /* Evita que o layout pule */
    }

    /* Rodapé */
    .card footer {
      text-align: center;
      font-size: 12px;
      color: #666666;
      opacity: 0.8;
      margin-top: 25px;
    }
  </style>

</head>
<body>

<div class="calculator-container">
  <div class="card">
    <header>
      <h1>Calculadora de Orçamento</h1>
      <p style="color:#666666;">Responda às perguntas para obter uma estimativa instantânea.</p>
      <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
    </header>
    <main id="chatbot"></main>
    <footer>
      Estimativa de Orçamento. Os valores podem variar.
    </footer>
  </div>
</div>

<script>
/* ==========================
   SUAS INFORMAÇÕES DO EMAILJS
========================== */
const EMAILJS_SERVICE_ID = 'service_c9pnfon';
const EMAILJS_TEMPLATE_ID = 'template_h0zi9nq';
const EMAILJS_PUBLIC_KEY = 'SLS8SEfkneyGnCM83';

/* ==========================
   CONFIGURAÇÕES E PREÇOS
========================== */
const OPTION_YES = 'Sim'; const OPTION_NO = 'Não'; const OPTION_NOT_NOW = 'Não incluir mensalidades agora';
const PAGES_UP_TO_5_INCLUDED = 'Até 5 (incluso no plano)'; const PAGES_6_7 = '6-7 páginas'; const PAGES_8_PLUS = '8+ páginas';
const EMAIL_UP_TO_3_INCLUDED = 'Até 3 (incluso no plano)'; const EMAIL_4_5 = 'Sim, 4-5 e-mails'; const EMAIL_NO_NEED = 'Não preciso';
const SERVICE_TYPES = { SITE_EXPRESSO: 'Site Expresso', SITE_SOB_MEDIDA: 'Site Sob Medida' };
const basePrices = { [SERVICE_TYPES.SITE_EXPRESSO]: 690, [SERVICE_TYPES.SITE_SOB_MEDIDA]: 0 };
const addOnPrices = { pages_6_7: 350, pages_8_plus: 700, email_4_5: 100, blogCMS: 450 };
const monthlyPrices = { siteHostingSupport: 99 };
const initialQuestions = [
  { id: 1, name: 'serviceType', text: 'Qual a solução ideal para o seu negócio?', options: Object.values(SERVICE_TYPES) },
  { id: 2, name: 'pagesCount', text: 'Quantas páginas você estima para o site?', options: [PAGES_UP_TO_5_INCLUDED, PAGES_6_7, PAGES_8_PLUS], relevantIf: (a) => a.serviceType === SERVICE_TYPES.SITE_EXPRESSO },
  { id: 3, name: 'emailAccounts', text: 'Você precisa de e-mails profissionais (@seudominio)?', options: [EMAIL_UP_TO_3_INCLUDED, EMAIL_4_5, EMAIL_NO_NEED], relevantIf: (a) => a.serviceType === SERVICE_TYPES.SITE_EXPRESSO },
  { id: 4, name: 'blogCMS', text: 'Precisará de um Blog com gerenciador de conteúdo?', options: [OPTION_YES, OPTION_NO], relevantIf: (a) => a.serviceType === SERVICE_TYPES.SITE_EXPRESSO },
  { id: 5, name: 'monthlyFee', text: 'Deseja incluir o valor da primeira mensalidade (Hospedagem e Suporte)?', options: [`Sim (R$ ${monthlyPrices.siteHostingSupport})`, OPTION_NOT_NOW], relevantIf: (a) => a.serviceType === SERVICE_TYPES.SITE_EXPRESSO },
];

let currentQuestionIndex = -1; let answers = {}; let results = null;

function calculateEstimateLogic(currentAnswers) {
  const details = []; let total = 0;
  if (currentAnswers.serviceType === SERVICE_TYPES.SITE_SOB_MEDIDA) { return { estimate: null, details: [], finalMessage: 'Para um "Site Sob Medida", com layout exclusivo e funcionalidades avançadas, elaboramos um orçamento personalizado para atender perfeitamente às suas necessidades. Por favor, entre em contato para conversarmos!' }; }
  const basePrice = basePrices[currentAnswers.serviceType]; total += basePrice;
  details.push({ item: `Serviço: ${currentAnswers.serviceType}`, cost: basePrice });
  details.push({ item: 'Até 5 páginas', cost: 0, notes: 'Incluso' });
  details.push({ item: 'Até 3 e-mails profissionais', cost: 0, notes: 'Incluso' });
  details.push({ item: 'Integração WhatsApp e SEO Básico', cost: 0, notes: 'Incluso' });
  if (currentAnswers.pagesCount === PAGES_6_7) { total += addOnPrices.pages_6_7; details.push({ item: 'Páginas Adicionais (6-7)', cost: addOnPrices.pages_6_7 }); } else if (currentAnswers.pagesCount === PAGES_8_PLUS) { total += addOnPrices.pages_8_plus; details.push({ item: 'Páginas Adicionais (8+)', cost: addOnPrices.pages_8_plus }); }
  if (currentAnswers.emailAccounts === EMAIL_4_5) { total += addOnPrices.email_4_5; details.push({ item: 'E-mails Adicionais (4-5)', cost: addOnPrices.email_4_5 }); }
  if (currentAnswers.blogCMS === OPTION_YES) { total += addOnPrices.blogCMS; details.push({ item: 'Blog com Gerenciador', cost: addOnPrices.blogCMS }); }
  if (currentAnswers.monthlyFee && currentAnswers.monthlyFee.startsWith('Sim')) { total += monthlyPrices.siteHostingSupport; details.push({ item: '1ª Mensalidade (Hospedagem/Suporte)', cost: monthlyPrices.siteHostingSupport }); }
  return { estimate: total, details, finalMessage: '' };
}

function renderQuestion() {
  const chatbot = document.getElementById("chatbot"); const progressBar = document.getElementById("progressBar");
  if (currentQuestionIndex === -1) {
    chatbot.innerHTML = `<h2>Para começar, informe seus dados:</h2><form class="initial-form" onsubmit="startQuestionnaire(event)"><input type="text" id="userName" placeholder="Seu Nome" required /><input type="email" id="userEmail" placeholder="Seu E-mail" required /><button type="submit">Iniciar Orçamento</button></form>`;
    progressBar.style.width = '0%';
  } else {
    const relevantQuestions = initialQuestions.filter(q => !q.relevantIf || q.relevantIf(answers));
    if (currentQuestionIndex >= relevantQuestions.length) { results = calculateEstimateLogic(answers); renderResults(); return; }
    const currentQuestionData = relevantQuestions[currentQuestionIndex];
    chatbot.innerHTML = `<h2>${currentQuestionData.text}</h2><div class="options">${currentQuestionData.options.map(opt => `<button onclick="handleAnswer('${currentQuestionData.name}', '${opt.replace(/'/g, "\\'")}')">${opt}</button>`).join('')}</div>`;
    progressBar.style.width = `${((currentQuestionIndex + 1) / relevantQuestions.length) * 100}%`;
  }
}

function startQuestionnaire(event) {
  event.preventDefault(); answers.userName = document.getElementById('userName').value; answers.userEmail = document.getElementById('userEmail').value; currentQuestionIndex = 0; renderQuestion();
}

function handleAnswer(name, value) {
  answers[name] = value; if (value === SERVICE_TYPES.SITE_SOB_MEDIDA) { results = calculateEstimateLogic(answers); renderResults(); return; } currentQuestionIndex++; renderQuestion();
}

function renderResults() {
  const chatbot = document.getElementById("chatbot"); document.getElementById("progressBar").style.width = `100%`; let resultsHtml = '';
  if (results.finalMessage) {
    resultsHtml = `<div class="results"><h2>Orçamento Personalizado</h2><p style="margin-bottom:30px;">${results.finalMessage}</p><div class="cta"><button class="btn-secondary" onclick="restartChat()">Refazer</button><a href="#contato">Solicitar Orçamento</a></div></div>`;
  } else {
    const finalDetails = results.details.filter((detail, index, self) => !(detail.notes === 'Incluso' && self.some(other => other.item.startsWith(detail.item) && other.cost > 0)));
    resultsHtml = `
      <div class="results">
        <h2>Sua estimativa de investimento:</h2>
        <p class="estimate-value">R$ ${results.estimate.toFixed(2).replace('.',',')}</p>
        <p class="monthly-fee">+ R$ ${monthlyPrices.siteHostingSupport.toFixed(2).replace('.',',')}/mês de hospedagem e suporte.</p>
        <p class="summary-title"><strong>Resumo da estimativa:</strong></p>
        <ul>${finalDetails.map(d => `<li><span>${d.item}${d.notes ? ' ('+d.notes+')' : ''}</span> <span>${d.cost > 0 ? "R$ "+d.cost.toFixed(2).replace('.',',') : "Incluso"}</span></li>`).join('')}</ul>
        <div class="cta">
          <a href="https://wa.me/5511919072390?text=${encodeURIComponent("Olá! Usei a calculadora e minha estimativa foi de R$"+results.estimate.toFixed(2)+" para um "+answers.serviceType+". Gostaria de mais detalhes.")}" target="_blank">Chamar no WhatsApp</a>
          <button class="btn-secondary" onclick="restartChat()">Refazer</button>
        </div>
        <div id="email-feedback"></div>
      </div>`;
  }
  chatbot.innerHTML = resultsHtml;
  sendAutomaticEmailWithEmailJS();
}

function sendAutomaticEmailWithEmailJS() {
    const feedback = document.getElementById('email-feedback');
    if (feedback) { feedback.textContent = "Enviando uma cópia para seu e-mail..."; }
    
    let budgetSummary = `Tipo de Serviço: ${answers.serviceType}<br>`;
    results.details.forEach(d => {
        const costText = d.cost > 0 ? `R$ ${d.cost.toFixed(2).replace('.',',')}` : "Incluso";
        budgetSummary += `${d.item}: ${costText}<br>`;
    });

    const templateParams = {
        nome_cliente: answers.userName,
        email_cliente: answers.userEmail,
        resumo_orcamento: budgetSummary,
        valor_total: results.estimate ? results.estimate.toFixed(2).replace('.',',') : 'Personalizado'
    };

    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams, EMAILJS_PUBLIC_KEY)
        .then((response) => {
           console.log('E-MAIL ENVIADO COM SUCESSO!', response.status, response.text);
           if (feedback) { feedback.textContent = "Orçamento enviado para seu e-mail!"; }
        }, (error) => {
           console.log('FALHA NO ENVIO DO E-MAIL...', error);
           if (feedback) { 
            feedback.textContent = "Ocorreu um erro ao tentar enviar o orçamento.";
            feedback.style.color = "#dc3545"; // Cor de erro
           }
        });
}

function restartChat() {
  currentQuestionIndex = -1; answers = {}; results = null; renderQuestion();
}

renderQuestion();
</script>
</body>
</html>